<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Display a GeoJSON Point Layer</title>
  <script src="https://cdn.maptiler.com/maptiler-sdk-js/v3.6.1/maptiler-sdk.umd.min.js"></script>
  <link href="https://cdn.maptiler.com/maptiler-sdk-js/v3.6.1/maptiler-sdk.css" rel="stylesheet" />
      <script src="https://unpkg.com/pmtiles@3.2.0/dist/pmtiles.js"></script>

  <style>
    body {
      margin: 0;
      padding: 0;
    }
    #map {
      position: absolute;
      top: 0;
      bottom: 0;
      width: 100%;
    }
  </style>
</head>
<body>
  <div id="map"></div>
  <script>
    maptilersdk.config.apiKey = '8Uqpw3E0b3ZQpe36fW7y';

    // add the PMTiles plugin to the maplibregl global.
    const protocol = new pmtiles.Protocol();
    maptilersdk.addProtocol('pmtiles', protocol.tile);

    const PMTILES_URL = 'https://kreed.org/strava/i351926.pmtiles';

    const p = new pmtiles.PMTiles(PMTILES_URL);

    // this is so we share one instance across the JS code and the map renderer
    protocol.add(p);

    // we first fetch the header so we can get the center lon, lat of the map.
    p.getHeader().then(h => {
        const map = new maptilersdk.Map({
            container: 'map',
            zoom: h.maxZoom - 2,
            center: [h.centerLon, h.centerLat],
            style: {
                version: 8,
                sources: {
                    'example_source': {
                        type: 'vector',
                        url: `pmtiles://${PMTILES_URL}`,
                        attribution: 'Â© <a href="https://openstreetmap.org/copyright">OpenStreetMap</a>'
                    }
                },
                layers: [
                    {
                        'id': 'buildings',
                        'source': 'example_source',
                        'source-layer': 'landuse',
                        'type': 'fill',
                        'paint': {
                            'fill-color': 'steelblue'
                        }
                    },
                    {
                        'id': 'roads',
                        'source': 'example_source',
                        'source-layer': 'roads',
                        'type': 'line',
                        'paint': {
                            'line-color': 'black'
                        }
                    },
                    {
                        'id': 'mask',
                        'source': 'example_source',
                        'source-layer': 'mask',
                        'type': 'fill',
                        'paint': {
                            'fill-color': 'white'
                        }
                    }
                ]
            }
        });
    });
  </script>
</body>
</html>